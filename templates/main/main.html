{% extends "base.html" %}
{% load humanize %} {% block content %}
<div style="max-width: 1000px; margin: 40px auto; padding: 0 20px; font-family: sans-serif;">
    <div style="display: flex; gap: 30px;">
        
        <div style="flex: 2;">
            <h2 style="border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px;">ìµœê·¼ ì—¬í–‰ì§€</h2>
            
            {% for trip in recent_trips %}
            <div style="background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 2px 2px 10px rgba(0,0,0,0.05);">
                
                <h3 style="margin: 0 0 10px 0; color: #007bff; font-size: 1.4rem;">
                    {{ trip.name }}
                </h3>
                
                <p style="margin: 5px 0;">ğŸ“… <strong>ì—¬í–‰ê¸°ê°„:</strong> {{ trip.start_date }} ~ {{ trip.end_date }}</p>
                <p style="margin: 5px 0;">ğŸ’° <strong>ì§€ì¶œì´ì•¡:</strong> {{ trip.total_spent|intcomma }}ì›</p>
                
                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #eee;">
                    <a href="{% url 'trip_detail' trip.id %}" style="text-decoration: none; color: #555; font-size: 0.9rem;">
                        <strong>ìƒì„¸ë³´ê¸° â†’</strong> 
                        <span style="color: #888; margin-left: 10px;">
                            {{ trip.memo|default:"ë“±ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤."|truncatechars:40 }}
                        </span>
                    </a>
                </div>
            </div>
            {% empty %}
            <p>ë“±ë¡ëœ ì—¬í–‰ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endfor %}
        </div>

        <div style="flex: 1;">
            <div style="background: #f4f4f4; border-radius: 12px; padding: 25px; border: 1px solid #eee;">
                <h2 style="margin-top: 0; font-size: 1.2rem; color: #444;">ğŸ“Š ì„œë¹„ìŠ¤ í†µê³„</h2>
                <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ddd;">
                
                <div style="margin-bottom: 20px;">
                    <small style="color: #777;">ì´ ì‚¬ìš©ì</small>
                    <div style="font-size: 1.5rem; font-weight: bold;">{{ total_users|intcomma }}ëª…</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <small style="color: #777;">ë“±ë¡ëœ ì—¬í–‰</small>
                    <div style="font-size: 1.5rem; font-weight: bold;">{{ total_trips|intcomma }}ê±´</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <small style="color: #777;">ëˆ„ì  ì§€ì¶œ ê¸ˆì•¡</small>
                    <div style="font-size: 1.5rem; font-weight: bold; color: #d63031;">{{ total_spent_all|intcomma }}ì›</div>
                </div>

                <div style="margin-top: 30px;">
                    <h3 style="margin-top: 0; font-size: 1.1rem; color: #444; margin-bottom: 15px;">ğŸŒ êµ­ê°€ë³„ ì§€ì¶œ TOP 3</h3>
                    <div style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0;">
                        <canvas id="topExpenseChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('topExpenseChart').getContext('2d');
        
        // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì²˜ë¦¬
        const labels = {{ labels|safe }};
        const data = {{ data|safe }};
        
        if (labels.length === 0) {
            ctx.font = "14px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("ì§€ì¶œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.", 100, 75);
            return;
        }

        new Chart(ctx, {
            type: 'doughnut', // ì„¸ë ¨ëœ ë„ë„› í˜•íƒœ
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#FF6384', // ë¹¨ê°•ê³„ì—´
                        '#36A2EB', // íŒŒë‘ê³„ì—´
                        '#FFCE56'  // ë…¸ë‘ê³„ì—´
                    ],
                    hoverOffset: 6
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            padding: 15,
                            font: { size: 11 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let value = context.raw;
                                return ' ' + value.toLocaleString() + 'ì›';
                            }
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}